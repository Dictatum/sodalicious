{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Terryl%20Jean/Downloads/sodalicious/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\r\nimport mysql from \"mysql2/promise\"\r\n\r\nconst connectionString = process.env.DATABASE_URL\r\n\r\nif (!connectionString) {\r\n  throw new Error(\"DATABASE_URL environment variable is not set\")\r\n}\r\n\r\n// Detect connection type: PostgreSQL (Neon) or MySQL (XAMPP)\r\nconst isPostgres = connectionString.startsWith(\"postgresql://\")\r\nconst isMysql = connectionString.startsWith(\"mysql://\")\r\n\r\nlet sql: any\r\n\r\nif (isPostgres) {\r\n  // Use Neon for PostgreSQL\r\n  sql = neon(connectionString)\r\n} else if (isMysql) {\r\n  // Use mysql2 for MySQL/XAMPP\r\n  const pool = mysql.createPool({\r\n    uri: connectionString,\r\n    waitForConnections: true,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  })\r\n\r\n  // Create a wrapper for mysql2 that mimics neon's API\r\n  sql = async (strings: TemplateStringsArray, ...values: any[]) => {\r\n    const connection = await pool.getConnection()\r\n    try {\r\n      // Build query from template strings\r\n      let query = strings[0]\r\n      for (let i = 0; i < values.length; i++) {\r\n        query += \"?\" + strings[i + 1]\r\n      }\r\n      const [rows] = await connection.query(query, values)\r\n      return rows\r\n    } finally {\r\n      connection.release()\r\n    }\r\n  }\r\n} else {\r\n  throw new Error(\r\n    `Unsupported database URL format. Use postgresql:// (Neon) or mysql:// (XAMPP). Got: ${connectionString.split(\"://\")[0]}://`\r\n  )\r\n}\r\n\r\nexport { sql }\r\n\r\n// Type definitions for database operations\r\nexport interface User {\r\n  id: number\r\n  email: string\r\n  name: string\r\n  role: \"cashier\" | \"manager\" | \"inventory_officer\"\r\n  is_active: boolean\r\n  created_at: string\r\n}\r\n\r\nexport interface Product {\r\n  id: number\r\n  name: string\r\n  category: string\r\n  price: number\r\n  description: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  is_active: boolean\r\n}\r\n\r\nexport interface Order {\r\n  id: number\r\n  order_number: string\r\n  cashier_id: number\r\n  customer_name: string\r\n  total_amount: number\r\n  payment_method: string\r\n  order_status: string\r\n  created_at: string\r\n}\r\n\r\nexport interface OrderItem {\r\n  id: number\r\n  order_id: number\r\n  product_id: number\r\n  quantity: number\r\n  unit_price: number\r\n  subtotal: number\r\n}\r\n\r\nexport interface InventoryLog {\r\n  id: number\r\n  ingredient_id: number\r\n  ingredient_name?: string\r\n  user_id: number\r\n  user_name?: string\r\n  log_type: string\r\n  quantity_changed: number\r\n  reason: string\r\n  previous_quantity: number\r\n  new_quantity: number\r\n  created_at: string\r\n}\r\n\r\nexport interface Ingredient {\r\n  id: number\r\n  name: string\r\n  unit: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  cost_per_unit: number\r\n  updated_at: string\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,6DAA6D;AAC7D,MAAM,aAAa,iBAAiB,UAAU,CAAC;AAC/C,MAAM,UAAU,iBAAiB,UAAU,CAAC;AAE5C,IAAI;AAEJ,IAAI,YAAY;IACd,0BAA0B;IAC1B,MAAM,IAAA,+KAAI,EAAC;AACb,OAAO,IAAI,SAAS;IAClB,6BAA6B;IAC7B,MAAM,OAAO,6JAAK,CAAC,UAAU,CAAC;QAC5B,KAAK;QACL,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;IACd;IAEA,qDAAqD;IACrD,MAAM,OAAO,SAA+B,GAAG;QAC7C,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,IAAI;YACF,oCAAoC;YACpC,IAAI,QAAQ,OAAO,CAAC,EAAE;YACtB,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;gBACtC,SAAS,MAAM,OAAO,CAAC,IAAI,EAAE;YAC/B;YACA,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,KAAK,CAAC,OAAO;YAC7C,OAAO;QACT,SAAU;YACR,WAAW,OAAO;QACpB;IACF;AACF,OAAO;IACL,MAAM,IAAI,MACR,CAAC,oFAAoF,EAAE,iBAAiB,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC;AAEhI","debugId":null}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Terryl%20Jean/Downloads/sodalicious/app/api/inventory/route.ts"],"sourcesContent":["import { sql } from \"@/lib/db\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\nimport { changeStockByName } from \"@/lib/menu-data\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const logs = await sql`\r\n      SELECT il.*, i.name as ingredient_name, u.name as user_name \r\n      FROM inventory_logs il \r\n      LEFT JOIN ingredients i ON il.ingredient_id = i.id \r\n      LEFT JOIN users u ON il.user_id = u.id \r\n      ORDER BY il.created_at DESC LIMIT 100\r\n    `\r\n\r\n    return NextResponse.json(logs)\r\n  } catch (error) {\r\n    console.error(\"[v0] Inventory GET error:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch inventory logs\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { ingredient_id, user_id, log_type, quantity_changed, reason } = await request.json()\r\n\r\n    // 1. Get current stock\r\n    let ingredientResult: any[] = []\r\n\r\n    // Try numeric ID lookup\r\n    if (!Number.isNaN(Number(ingredient_id))) {\r\n      const byId = await sql`SELECT id, name, stock_quantity FROM ingredients WHERE id = ${Number(ingredient_id)}`\r\n      if (byId.length > 0) ingredientResult = byId\r\n    }\r\n\r\n    if (ingredientResult.length === 0) {\r\n      // Fallback: name\r\n      const byName = await sql`SELECT id, name, stock_quantity FROM ingredients WHERE name = ${String(ingredient_id)} LIMIT 1`\r\n      if (byName.length > 0) ingredientResult = byName\r\n    }\r\n\r\n    if (ingredientResult.length === 0) {\r\n      console.error(`[Inventory] Ingredient not found with ID/name: ${ingredient_id}`)\r\n      return NextResponse.json({ error: \"Ingredient not found\" }, { status: 404 })\r\n    }\r\n\r\n    const previousQuantity = ingredientResult[0].stock_quantity\r\n    const newQuantity = Number(previousQuantity) + Number(quantity_changed)\r\n\r\n    // 2. Update stock in DB\r\n    await sql`UPDATE ingredients SET stock_quantity = ${newQuantity} WHERE id = ${ingredientResult[0].id}`\r\n\r\n    // 3. Log the change\r\n    const insertResult: any = await sql`\r\n      INSERT INTO inventory_logs (ingredient_id, user_id, log_type, quantity_changed, reason, previous_quantity, new_quantity) \r\n      VALUES (${ingredientResult[0].id}, ${user_id}, ${log_type}, ${quantity_changed}, ${reason}, ${previousQuantity}, ${newQuantity})\r\n    `\r\n\r\n    // Normalize result\r\n    let logRow: any = null\r\n    if (insertResult && typeof insertResult.insertId === \"number\") {\r\n      const sel = await sql`\r\n         SELECT il.*, i.name as ingredient_name, u.name as user_name \r\n         FROM inventory_logs il \r\n         LEFT JOIN ingredients i ON il.ingredient_id = i.id \r\n         LEFT JOIN users u ON il.user_id = u.id \r\n         WHERE il.id = ${insertResult.insertId} LIMIT 1\r\n       `\r\n      if (Array.isArray(sel)) logRow = sel[0]; else logRow = sel;\r\n    } else {\r\n      // Fallback\r\n      const sel = await sql`\r\n         SELECT il.*, i.name as ingredient_name, u.name as user_name \r\n         FROM inventory_logs il \r\n         LEFT JOIN ingredients i ON il.ingredient_id = i.id \r\n         LEFT JOIN users u ON il.user_id = u.id \r\n         WHERE il.ingredient_id = ${ingredientResult[0].id} \r\n         ORDER BY il.created_at DESC LIMIT 1\r\n       `\r\n      if (Array.isArray(sel)) logRow = sel[0]; else logRow = sel;\r\n    }\r\n\r\n    return NextResponse.json(logRow, { status: 201 })\r\n  } catch (error) {\r\n    console.error(\"[Inventory] POST error:\", error)\r\n    return NextResponse.json({ error: \"Failed to log inventory change\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,OAAO,MAAM,iIAAG,CAAC;;;;;;IAMvB,CAAC;QAED,OAAO,+JAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,+JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACtF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,aAAa,EAAE,OAAO,EAAE,QAAQ,EAAE,gBAAgB,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEzF,uBAAuB;QACvB,IAAI,mBAA0B,EAAE;QAEhC,wBAAwB;QACxB,IAAI,CAAC,OAAO,KAAK,CAAC,OAAO,iBAAiB;YACxC,MAAM,OAAO,MAAM,iIAAG,CAAC,4DAA4D,EAAE,OAAO,eAAe,CAAC;YAC5G,IAAI,KAAK,MAAM,GAAG,GAAG,mBAAmB;QAC1C;QAEA,IAAI,iBAAiB,MAAM,KAAK,GAAG;YACjC,iBAAiB;YACjB,MAAM,SAAS,MAAM,iIAAG,CAAC,8DAA8D,EAAE,OAAO,eAAe,QAAQ,CAAC;YACxH,IAAI,OAAO,MAAM,GAAG,GAAG,mBAAmB;QAC5C;QAEA,IAAI,iBAAiB,MAAM,KAAK,GAAG;YACjC,QAAQ,KAAK,CAAC,CAAC,+CAA+C,EAAE,eAAe;YAC/E,OAAO,+JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,MAAM,mBAAmB,gBAAgB,CAAC,EAAE,CAAC,cAAc;QAC3D,MAAM,cAAc,OAAO,oBAAoB,OAAO;QAEtD,wBAAwB;QACxB,MAAM,iIAAG,CAAC,wCAAwC,EAAE,YAAY,YAAY,EAAE,gBAAgB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QAEtG,oBAAoB;QACpB,MAAM,eAAoB,MAAM,iIAAG,CAAC;;cAE1B,EAAE,gBAAgB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,QAAQ,EAAE,EAAE,SAAS,EAAE,EAAE,iBAAiB,EAAE,EAAE,OAAO,EAAE,EAAE,iBAAiB,EAAE,EAAE,YAAY;IACjI,CAAC;QAED,mBAAmB;QACnB,IAAI,SAAc;QAClB,IAAI,gBAAgB,OAAO,aAAa,QAAQ,KAAK,UAAU;YAC7D,MAAM,MAAM,MAAM,iIAAG,CAAC;;;;;uBAKL,EAAE,aAAa,QAAQ,CAAC;OACxC,CAAC;YACF,IAAI,MAAM,OAAO,CAAC,MAAM,SAAS,GAAG,CAAC,EAAE;iBAAO,SAAS;QACzD,OAAO;YACL,WAAW;YACX,MAAM,MAAM,MAAM,iIAAG,CAAC;;;;;kCAKM,EAAE,gBAAgB,CAAC,EAAE,CAAC,EAAE,CAAC;;OAEpD,CAAC;YACF,IAAI,MAAM,OAAO,CAAC,MAAM,SAAS,GAAG,CAAC,EAAE;iBAAO,SAAS;QACzD;QAEA,OAAO,+JAAY,CAAC,IAAI,CAAC,QAAQ;YAAE,QAAQ;QAAI;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,+JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACtF;AACF","debugId":null}}]
}