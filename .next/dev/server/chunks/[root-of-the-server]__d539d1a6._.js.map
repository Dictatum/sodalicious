{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\r\n\r\nconst connectionString = process.env.DATABASE_URL\r\n\r\nif (!connectionString) {\r\n  throw new Error(\"DATABASE_URL environment variable is not set\")\r\n}\r\n\r\nexport const sql = neon(connectionString)\r\n\r\n// Type definitions for database operations\r\nexport interface User {\r\n  id: number\r\n  email: string\r\n  name: string\r\n  role: \"cashier\" | \"manager\" | \"inventory_officer\"\r\n  is_active: boolean\r\n  created_at: string\r\n}\r\n\r\nexport interface Product {\r\n  id: number\r\n  name: string\r\n  category: string\r\n  price: number\r\n  description: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  is_active: boolean\r\n}\r\n\r\nexport interface Order {\r\n  id: number\r\n  order_number: string\r\n  cashier_id: number\r\n  customer_name: string\r\n  total_amount: number\r\n  payment_method: string\r\n  order_status: string\r\n  created_at: string\r\n}\r\n\r\nexport interface OrderItem {\r\n  id: number\r\n  order_id: number\r\n  product_id: number\r\n  quantity: number\r\n  unit_price: number\r\n  subtotal: number\r\n}\r\n\r\nexport interface InventoryLog {\r\n  id: number\r\n  product_id: number\r\n  user_id: number\r\n  log_type: string\r\n  quantity_changed: number\r\n  reason: string\r\n  previous_quantity: number\r\n  new_quantity: number\r\n  created_at: string\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,MAAM,IAAA,gKAAI,EAAC","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/lib/menu-data.ts"],"sourcesContent":["/**\r\n * SODALICIOUS.CO â€“ Complete POS Menu Data\r\n * Synced across Cashier, Manager, and Inventory panels\r\n * All prices in PHP, Stock quantities for tracking\r\n */\r\n\r\nexport interface MenuItem {\r\n  id: string\r\n  name: string\r\n  category: string\r\n  categoryCode: string\r\n  sizes: Array<{\r\n    size: string\r\n    price: number\r\n  }>\r\n  description?: string\r\n  stock: number\r\n  minThreshold: number\r\n  image?: string\r\n}\r\n\r\n// â˜• HOT COFFEE\r\nexport const HOT_COFFEE: MenuItem[] = [\r\n  {\r\n    id: \"HC001\",\r\n    name: \"Americano\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 45 },\r\n      { size: \"M\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Classic Italian espresso with hot water\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"HC002\",\r\n    name: \"CafÃ© Latte\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 55 },\r\n      { size: \"M\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Smooth espresso with steamed milk\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"HC003\",\r\n    name: \"Cappuccino\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 55 },\r\n      { size: \"M\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Espresso with equal parts milk and foam\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"HC004\",\r\n    name: \"Caramel Macchiato\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 60 },\r\n      { size: \"M\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Rich espresso with caramel and steamed milk\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"HC005\",\r\n    name: \"Mocha\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 60 },\r\n      { size: \"M\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Espresso, steamed milk, and chocolate\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n]\r\n\r\n// ðŸ§Š ICED COFFEE\r\nexport const ICED_COFFEE: MenuItem[] = [\r\n  {\r\n    id: \"IC001\",\r\n    name: \"Iced Americano\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Cold espresso with ice and water\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"IC002\",\r\n    name: \"Iced Latte\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Smooth iced espresso with cold milk\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"IC003\",\r\n    name: \"Iced Caramel\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Iced espresso with caramel and milk\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"IC004\",\r\n    name: \"Iced Vanilla Brew\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Cold brew with vanilla essence\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"IC005\",\r\n    name: \"Iced Mocha\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Iced espresso with chocolate and milk\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// ðŸ¥¤ FRAPPES\r\nexport const FRAPPES: MenuItem[] = [\r\n  {\r\n    id: \"FR001\",\r\n    name: \"Chocolate Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 75 }],\r\n    description: \"Blended chocolate frappe with whipped cream\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"FR002\",\r\n    name: \"Caramel Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 75 }],\r\n    description: \"Blended caramel frappe with whipped cream\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"FR003\",\r\n    name: \"Cookies & Cream Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 80 }],\r\n    description: \"Cookies and cream blended frappe\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"FR004\",\r\n    name: \"Matcha Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 85 }],\r\n    description: \"Blended matcha frappe with whipped cream\",\r\n    stock: 40,\r\n    minThreshold: 6,\r\n  },\r\n  {\r\n    id: \"FR005\",\r\n    name: \"Coffee Jelly Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 80 }],\r\n    description: \"Coffee frappe with coffee jelly bits\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n]\r\n\r\n// ðŸ«§ SODA SERIES\r\nexport const SODA_SERIES: MenuItem[] = [\r\n  {\r\n    id: \"SS001\",\r\n    name: \"Blue Lemon Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Refreshing blue lemon carbonated drink\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SS002\",\r\n    name: \"Strawberry Fizz\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Sweet strawberry flavored soda\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SS003\",\r\n    name: \"Green Apple Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Crisp green apple soda\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SS004\",\r\n    name: \"Lychee Pop Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Tropical lychee flavored soda\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"SS005\",\r\n    name: \"Mango Burst Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Tropical mango soda explosion\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n]\r\n\r\n// ðŸ§ƒ YAKULT SERIES\r\nexport const YAKULT_SERIES: MenuItem[] = [\r\n  {\r\n    id: \"YK001\",\r\n    name: \"Blue Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic blue flavored Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK002\",\r\n    name: \"Strawberry Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic strawberry Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK003\",\r\n    name: \"Green Apple Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic green apple Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK004\",\r\n    name: \"Mango Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic mango Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK005\",\r\n    name: \"Lychee Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic lychee Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// ðŸµ MATCHA SERIES\r\nexport const MATCHA_SERIES: MenuItem[] = [\r\n  {\r\n    id: \"MC001\",\r\n    name: \"Classic Matcha\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Traditional matcha powder blend\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"MC002\",\r\n    name: \"Matcha Latte\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 75 },\r\n      { size: \"L\", price: 85 },\r\n    ],\r\n    description: \"Matcha with steamed milk\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"MC003\",\r\n    name: \"Matcha Caramel\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 80 },\r\n      { size: \"L\", price: 90 },\r\n    ],\r\n    description: \"Matcha with caramel drizzle\",\r\n    stock: 40,\r\n    minThreshold: 6,\r\n  },\r\n  {\r\n    id: \"MC004\",\r\n    name: \"Matcha Vanilla\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 75 },\r\n      { size: \"L\", price: 85 },\r\n    ],\r\n    description: \"Matcha with vanilla essence\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"MC005\",\r\n    name: \"Dirty Matcha\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 85 },\r\n      { size: \"L\", price: 95 },\r\n    ],\r\n    description: \"Matcha with espresso shot\",\r\n    stock: 40,\r\n    minThreshold: 6,\r\n  },\r\n]\r\n\r\n// ðŸ± COMBO MEALS\r\nexport const COMBO_MEALS: MenuItem[] = [\r\n  {\r\n    id: \"CM001\",\r\n    name: \"Fries + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 99 }],\r\n    description: \"Regular Fries + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"CM002\",\r\n    name: \"Siomai Rice + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 110 }],\r\n    description: \"Siomai Rice + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"CM003\",\r\n    name: \"Burger + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 120 }],\r\n    description: \"Cheeseburger + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"CM004\",\r\n    name: \"Nuggets + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 115 }],\r\n    description: \"6pcs Nuggets + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"CM005\",\r\n    name: \"Hotdog + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 99 }],\r\n    description: \"Hotdog Sandwich + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// ðŸŸ SNACKS\r\nexport const SNACKS: MenuItem[] = [\r\n  {\r\n    id: \"SN001\",\r\n    name: \"Fries\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [\r\n      { size: \"Reg\", price: 45 },\r\n      { size: \"Lrg\", price: 60 },\r\n    ],\r\n    description: \"Crispy golden fries\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SN002\",\r\n    name: \"Kropek\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"Solo\", price: 45 }],\r\n    description: \"Crispy prawn cracker\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"SN003\",\r\n    name: \"Nachos\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"Solo\", price: 60 }],\r\n    description: \"Cheese nachos with dip\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"SN004\",\r\n    name: \"Cheese Sticks\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"6 pcs\", price: 50 }],\r\n    description: \"Golden fried cheese sticks\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"SN005\",\r\n    name: \"Siomai Rice\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"Solo\", price: 55 }],\r\n    description: \"Siomai served with rice\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// Combined complete menu\r\nexport const COMPLETE_MENU: MenuItem[] = [\r\n  ...HOT_COFFEE,\r\n  ...ICED_COFFEE,\r\n  ...FRAPPES,\r\n  ...SODA_SERIES,\r\n  ...YAKULT_SERIES,\r\n  ...MATCHA_SERIES,\r\n  ...COMBO_MEALS,\r\n  ...SNACKS,\r\n]\r\n\r\n// Menu categories for filtering\r\nexport const MENU_CATEGORIES = [\r\n  { code: \"HC\", name: \"Hot Coffee\", emoji: \"â˜•\" },\r\n  { code: \"IC\", name: \"Iced Coffee\", emoji: \"ðŸ§Š\" },\r\n  { code: \"FR\", name: \"Frappes\", emoji: \"ðŸ¥¤\" },\r\n  { code: \"SS\", name: \"Soda Series\", emoji: \"ðŸ«§\" },\r\n  { code: \"YK\", name: \"Yakult Series\", emoji: \"ðŸ§ƒ\" },\r\n  { code: \"MC\", name: \"Matcha Series\", emoji: \"ðŸµ\" },\r\n  { code: \"CM\", name: \"Combo Meals\", emoji: \"ðŸ±\" },\r\n  { code: \"SN\", name: \"Snacks\", emoji: \"ðŸŸ\" },\r\n]\r\n\r\n// Helper function to get menu items by category\r\nexport function getMenuByCategory(categoryCode: string): MenuItem[] {\r\n  return COMPLETE_MENU.filter((item) => item.categoryCode === categoryCode)\r\n}\r\n\r\n// Helper function to get all categories\r\nexport function getAllCategories(): string[] {\r\n  return MENU_CATEGORIES.map((cat) => cat.name)\r\n}\r\n\r\n// Helper function to convert MenuItem to Product format for store compatibility\r\nexport function menuItemToProduct(item: MenuItem, sizeIndex: number = 0) {\r\n  const size = item.sizes[sizeIndex]\r\n  return {\r\n    id: item.id,\r\n    name: `${item.name} (${size.size})`,\r\n    price: size.price,\r\n    category: item.category,\r\n    stock: item.stock,\r\n    minThreshold: item.minThreshold,\r\n    description: item.description,\r\n    image: item.image,\r\n  }\r\n}\r\n\r\n// Get all products flattened with sizes as separate entries\r\nexport function getAllProductVariants() {\r\n  return COMPLETE_MENU.flatMap((item) =>\r\n    item.sizes.map((size, index) => ({\r\n      id: `${item.id}-${size.size}`,\r\n      baseId: item.id,\r\n      name: item.name,\r\n      size: size.size,\r\n      price: size.price,\r\n      category: item.category,\r\n      categoryCode: item.categoryCode,\r\n      stock: item.stock,\r\n      minThreshold: item.minThreshold,\r\n      description: item.description,\r\n      image: item.image,\r\n    })),\r\n  )\r\n}\r\n\r\n// Get base menu items (one per drink, no size duplication) - for cashier modal selection\r\nexport function getBaseMenuItems() {\r\n  return COMPLETE_MENU.map((item) => ({\r\n    id: item.id,\r\n    name: item.name,\r\n    category: item.category,\r\n    categoryCode: item.categoryCode,\r\n    sizes: item.sizes,\r\n    description: item.description,\r\n    stock: item.stock,\r\n    minThreshold: item.minThreshold,\r\n    image: item.image,\r\n  }))\r\n}\r\n\r\n// Stock management functions\r\nexport function deductStock(productId: string, quantity: number): boolean {\r\n  const item = COMPLETE_MENU.find((i) => i.id === productId)\r\n  if (!item) return false\r\n  if (item.stock < quantity) return false\r\n  \r\n  item.stock -= quantity\r\n  return true\r\n}\r\n\r\nexport function getProductById(productId: string): MenuItem | undefined {\r\n  return COMPLETE_MENU.find((i) => i.id === productId)\r\n}\r\n\r\nexport function updateProductStock(productId: string, newStock: number): boolean {\r\n  const item = COMPLETE_MENU.find((i) => i.id === productId)\r\n  if (!item) return false\r\n  \r\n  item.stock = Math.max(0, newStock)\r\n  return true\r\n}\r\n\r\n// Find a menu item by base name (e.g. \"Americano\")\r\nexport function findMenuItemByName(baseName: string) {\r\n  return COMPLETE_MENU.find((i) => i.name === baseName)\r\n}\r\n\r\n// Adjust stock by a delta using the base product name. Positive delta = restock.\r\nexport function changeStockByName(baseName: string, delta: number): boolean {\r\n  const item = findMenuItemByName(baseName)\r\n  if (!item) return false\r\n  item.stock = Math.max(0, item.stock + delta)\r\n  return true\r\n}\r\n\r\n// Set absolute stock by base product name.\r\nexport function setStockByName(baseName: string, newStock: number): boolean {\r\n  const item = findMenuItemByName(baseName)\r\n  if (!item) return false\r\n  item.stock = Math.max(0, newStock)\r\n  return true\r\n}\r\n\r\nexport function getStockLevel(productId: string): number {\r\n  const item = COMPLETE_MENU.find((i) => i.id === productId)\r\n  return item?.stock || 0\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkBM,MAAM,aAAyB;IACpC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,cAA0B;IACrC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,UAAsB;IACjC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,cAA0B;IACrC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,gBAA4B;IACvC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,gBAA4B;IACvC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAK,OAAO;YAAG;YACvB;gBAAE,MAAM;gBAAK,OAAO;YAAG;SACxB;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,cAA0B;IACrC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAS,OAAO;YAAG;SAAE;QACrC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAS,OAAO;YAAI;SAAE;QACtC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAS,OAAO;YAAI;SAAE;QACtC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAS,OAAO;YAAI;SAAE;QACtC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAS,OAAO;YAAG;SAAE;QACrC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,SAAqB;IAChC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YACL;gBAAE,MAAM;gBAAO,OAAO;YAAG;YACzB;gBAAE,MAAM;gBAAO,OAAO;YAAG;SAC1B;QACD,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAS,OAAO;YAAG;SAAE;QACrC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,cAAc;QACd,OAAO;YAAC;gBAAE,MAAM;gBAAQ,OAAO;YAAG;SAAE;QACpC,aAAa;QACb,OAAO;QACP,cAAc;IAChB;CACD;AAGM,MAAM,gBAA4B;OACpC;OACA;OACA;OACA;OACA;OACA;OACA;OACA;CACJ;AAGM,MAAM,kBAAkB;IAC7B;QAAE,MAAM;QAAM,MAAM;QAAc,OAAO;IAAI;IAC7C;QAAE,MAAM;QAAM,MAAM;QAAe,OAAO;IAAK;IAC/C;QAAE,MAAM;QAAM,MAAM;QAAW,OAAO;IAAK;IAC3C;QAAE,MAAM;QAAM,MAAM;QAAe,OAAO;IAAK;IAC/C;QAAE,MAAM;QAAM,MAAM;QAAiB,OAAO;IAAK;IACjD;QAAE,MAAM;QAAM,MAAM;QAAiB,OAAO;IAAK;IACjD;QAAE,MAAM;QAAM,MAAM;QAAe,OAAO;IAAK;IAC/C;QAAE,MAAM;QAAM,MAAM;QAAU,OAAO;IAAK;CAC3C;AAGM,SAAS,kBAAkB,YAAoB;IACpD,OAAO,cAAc,MAAM,CAAC,CAAC,OAAS,KAAK,YAAY,KAAK;AAC9D;AAGO,SAAS;IACd,OAAO,gBAAgB,GAAG,CAAC,CAAC,MAAQ,IAAI,IAAI;AAC9C;AAGO,SAAS,kBAAkB,IAAc,EAAE,YAAoB,CAAC;IACrE,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;IAClC,OAAO;QACL,IAAI,KAAK,EAAE;QACX,MAAM,GAAG,KAAK,IAAI,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC;QACnC,OAAO,KAAK,KAAK;QACjB,UAAU,KAAK,QAAQ;QACvB,OAAO,KAAK,KAAK;QACjB,cAAc,KAAK,YAAY;QAC/B,aAAa,KAAK,WAAW;QAC7B,OAAO,KAAK,KAAK;IACnB;AACF;AAGO,SAAS;IACd,OAAO,cAAc,OAAO,CAAC,CAAC,OAC5B,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;gBAC/B,IAAI,GAAG,KAAK,EAAE,CAAC,CAAC,EAAE,KAAK,IAAI,EAAE;gBAC7B,QAAQ,KAAK,EAAE;gBACf,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,UAAU,KAAK,QAAQ;gBACvB,cAAc,KAAK,YAAY;gBAC/B,OAAO,KAAK,KAAK;gBACjB,cAAc,KAAK,YAAY;gBAC/B,aAAa,KAAK,WAAW;gBAC7B,OAAO,KAAK,KAAK;YACnB,CAAC;AAEL;AAGO,SAAS;IACd,OAAO,cAAc,GAAG,CAAC,CAAC,OAAS,CAAC;YAClC,IAAI,KAAK,EAAE;YACX,MAAM,KAAK,IAAI;YACf,UAAU,KAAK,QAAQ;YACvB,cAAc,KAAK,YAAY;YAC/B,OAAO,KAAK,KAAK;YACjB,aAAa,KAAK,WAAW;YAC7B,OAAO,KAAK,KAAK;YACjB,cAAc,KAAK,YAAY;YAC/B,OAAO,KAAK,KAAK;QACnB,CAAC;AACH;AAGO,SAAS,YAAY,SAAiB,EAAE,QAAgB;IAC7D,MAAM,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAChD,IAAI,CAAC,MAAM,OAAO;IAClB,IAAI,KAAK,KAAK,GAAG,UAAU,OAAO;IAElC,KAAK,KAAK,IAAI;IACd,OAAO;AACT;AAEO,SAAS,eAAe,SAAiB;IAC9C,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AAC5C;AAEO,SAAS,mBAAmB,SAAiB,EAAE,QAAgB;IACpE,MAAM,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAChD,IAAI,CAAC,MAAM,OAAO;IAElB,KAAK,KAAK,GAAG,KAAK,GAAG,CAAC,GAAG;IACzB,OAAO;AACT;AAGO,SAAS,mBAAmB,QAAgB;IACjD,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK;AAC9C;AAGO,SAAS,kBAAkB,QAAgB,EAAE,KAAa;IAC/D,MAAM,OAAO,mBAAmB;IAChC,IAAI,CAAC,MAAM,OAAO;IAClB,KAAK,KAAK,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,GAAG;IACtC,OAAO;AACT;AAGO,SAAS,eAAe,QAAgB,EAAE,QAAgB;IAC/D,MAAM,OAAO,mBAAmB;IAChC,IAAI,CAAC,MAAM,OAAO;IAClB,KAAK,KAAK,GAAG,KAAK,GAAG,CAAC,GAAG;IACzB,OAAO;AACT;AAEO,SAAS,cAAc,SAAiB;IAC7C,MAAM,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAChD,OAAO,MAAM,SAAS;AACxB","debugId":null}},
    {"offset": {"line": 989, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/app/api/orders/route.ts"],"sourcesContent":["import { sql } from \"@/lib/db\"\r\nimport { deductStock, getProductById, setStockByName } from \"@/lib/menu-data\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams\r\n    const limit = searchParams.get(\"limit\") || \"50\"\r\n\r\n    const orders = await sql`\r\n      SELECT o.*, u.name as cashier_name FROM orders o \r\n      LEFT JOIN users u ON o.cashier_id = u.id \r\n      ORDER BY o.created_at DESC LIMIT ${Number.parseInt(limit)}\r\n    `\r\n\r\n    return NextResponse.json(orders)\r\n  } catch (error) {\r\n    console.error(\"[API] Orders GET error:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch orders\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { cashier_id, customer_name, total_amount, payment_method, items } = await request.json()\r\n\r\n    if (!items || items.length === 0) {\r\n      return NextResponse.json({ error: \"Order must have at least one item\" }, { status: 400 })\r\n    }\r\n\r\n    // Generate order number\r\n    const orderNumber = `ORD-${Date.now()}`\r\n\r\n    // Validate all items have sufficient stock in menu-data\r\n    for (const item of items) {\r\n      const product = getProductById(item.product_id)\r\n      if (!product || product.stock < item.quantity) {\r\n        return NextResponse.json(\r\n          { error: `Insufficient stock for ${item.name}. Available: ${product?.stock || 0}` },\r\n          { status: 400 }\r\n        )\r\n      }\r\n    }\r\n\r\n    // Deduct stock from in-memory menu-data\r\n    for (const item of items) {\r\n      const deducted = deductStock(item.product_id, item.quantity)\r\n      if (!deducted) {\r\n        return NextResponse.json(\r\n          { error: `Failed to deduct stock for product ${item.product_id}` },\r\n          { status: 400 }\r\n        )\r\n      }\r\n      console.log(`[Stock] Deducted ${item.quantity} units of ${item.product_id} from memory. Remaining: ${getProductById(item.product_id)?.stock || 0}`)\r\n    }\r\n\r\n    try {\r\n      // First, ensure we have a valid cashier_id by fetching from database\r\n      let validCashierId = cashier_id\r\n      \r\n      // Always validate the cashier exists in database\r\n      let cashierExists = false\r\n      if (validCashierId) {\r\n        const cashierCheck = await sql`\r\n          SELECT id FROM users WHERE id = ${validCashierId} AND role = 'cashier' LIMIT 1\r\n        `\r\n        cashierExists = cashierCheck.length > 0\r\n      }\r\n      \r\n      if (!cashierExists) {\r\n        // Get first cashier from database\r\n        const cashiers = await sql`\r\n          SELECT id FROM users WHERE role = 'cashier' LIMIT 1\r\n        `\r\n        if (cashiers.length > 0) {\r\n          validCashierId = cashiers[0].id\r\n          console.log(`[Order] Using valid cashier ID from database: ${validCashierId}`)\r\n        } else {\r\n          console.error(\"[Order] No cashiers found in database!\")\r\n          return NextResponse.json(\r\n            { error: \"No cashiers available in database. Database may not be seeded.\" },\r\n            { status: 500 }\r\n          )\r\n        }\r\n      }\r\n\r\n      // Insert order into database\r\n      const orderResult = await sql`\r\n        INSERT INTO orders (order_number, cashier_id, customer_name, total_amount, payment_method, order_status) \r\n        VALUES (${orderNumber}, ${validCashierId}, ${customer_name}, ${total_amount}, ${payment_method}, 'pending') \r\n        RETURNING *\r\n      `\r\n\r\n      const orderId = orderResult[0].id\r\n      console.log(`[DB] Order ${orderNumber} created with ID: ${orderId}`)\r\n\r\n      // Insert order items and update product stock in database (best-effort mapping between menu-data and DB)\r\n      for (const item of items) {\r\n        // First, map the menu item ID to database product ID\r\n        const baseName = String(item.name).split(\" (\")[0]\r\n        let dbProduct: any = null\r\n\r\n        try {\r\n          // try numeric id mapping\r\n          if (!Number.isNaN(Number(item.product_id))) {\r\n            const byId = await sql`SELECT id, name, stock_quantity FROM products WHERE id = ${Number(item.product_id)}`\r\n            if (byId.length > 0) dbProduct = byId[0]\r\n          }\r\n\r\n          // fallback: try by name\r\n          if (!dbProduct) {\r\n            const byName = await sql`SELECT id, name, stock_quantity FROM products WHERE name = ${baseName} LIMIT 1`\r\n            if (byName.length > 0) dbProduct = byName[0]\r\n          }\r\n\r\n          // If we found the product, use its numeric ID for order_items\r\n          let dbProductId = dbProduct?.id\r\n          \r\n          // If product ID couldn't be resolved, skip order_items insertion to avoid constraint violation\r\n          if (!dbProductId) {\r\n            console.warn(`[DB] Could not map product ID for item: ${baseName} / ${item.product_id}. Skipping order_items insertion.`)\r\n            continue\r\n          }\r\n\r\n          await sql`\r\n            INSERT INTO order_items (order_id, product_id, quantity, unit_price, subtotal) \r\n            VALUES (${orderId}, ${dbProductId}, ${item.quantity}, ${item.price}, ${item.subtotal})\r\n          `\r\n\r\n          if (dbProduct) {\r\n            const newDbStock = dbProduct.stock_quantity - item.quantity\r\n            await sql`UPDATE products SET stock_quantity = ${newDbStock} WHERE id = ${dbProduct.id}`\r\n            // sync server in-memory menu-data to reflect DB change (best-effort)\r\n            try {\r\n              setStockByName(dbProduct.name, newDbStock)\r\n            } catch (e) {\r\n              console.warn(\"[Orders] Failed to sync in-memory menu-data after DB update\", e)\r\n            }\r\n\r\n            console.log(`[DB] Updated stock for product ${dbProduct.id} (${dbProduct.name}): -${item.quantity} units`)\r\n          } else {\r\n            // No DB mapping found; still log and continue\r\n            console.warn(`[DB] Could not find DB product to update for order item: ${item.product_id} / ${baseName}`)\r\n          }\r\n        } catch (err) {\r\n          console.error(\"[DB] Error updating product stock for order item\", err)\r\n        }\r\n      }\r\n\r\n      console.log(`[Order] âœ“ Order ${orderNumber} created successfully and database updated`)\r\n\r\n      return NextResponse.json(\r\n        {\r\n          id: orderResult[0].id,\r\n          order_number: orderNumber,\r\n          customer_name,\r\n          total_amount,\r\n          payment_method,\r\n          order_status: \"pending\",\r\n          created_at: new Date().toISOString(),\r\n        },\r\n        { status: 201 }\r\n      )\r\n    } catch (dbError) {\r\n      console.error(\"[DB Error]\", dbError)\r\n      // Stock is already deducted from menu-data, but DB failed\r\n      return NextResponse.json(\r\n        {\r\n          id: Date.now(),\r\n          order_number: orderNumber,\r\n          customer_name,\r\n          total_amount,\r\n          payment_method,\r\n          order_status: \"pending\",\r\n          warning: \"Order created and stock reduced in-memory, but database sync may have failed\",\r\n          created_at: new Date().toISOString(),\r\n        },\r\n        { status: 201 }\r\n      )\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[API] Orders POST error:\", error)\r\n    return NextResponse.json({ error: \"Failed to create order\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}