{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Terryl%20Jean/Downloads/sodalicious/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\r\nimport mysql from \"mysql2/promise\"\r\n\r\nconst connectionString = process.env.DATABASE_URL\r\n\r\nif (!connectionString) {\r\n  throw new Error(\"DATABASE_URL environment variable is not set\")\r\n}\r\n\r\n// Detect connection type: PostgreSQL (Neon) or MySQL (XAMPP)\r\nconst isPostgres = connectionString.startsWith(\"postgresql://\")\r\nconst isMysql = connectionString.startsWith(\"mysql://\")\r\n\r\nlet sql: any\r\n\r\nif (isPostgres) {\r\n  // Use Neon for PostgreSQL\r\n  sql = neon(connectionString)\r\n} else if (isMysql) {\r\n  // Use mysql2 for MySQL/XAMPP\r\n  const pool = mysql.createPool({\r\n    uri: connectionString,\r\n    waitForConnections: true,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  })\r\n\r\n  // Create a wrapper for mysql2 that mimics neon's API\r\n  sql = async (strings: TemplateStringsArray, ...values: any[]) => {\r\n    const connection = await pool.getConnection()\r\n    try {\r\n      // Build query from template strings\r\n      let query = strings[0]\r\n      for (let i = 0; i < values.length; i++) {\r\n        query += \"?\" + strings[i + 1]\r\n      }\r\n\r\n      // DEBUG LOGGING\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.log(`[DB] Query: ${query.trim().replace(/\\s+/g, ' ')}`)\r\n        if (values.length > 0) console.log(`[DB] Values:`, values)\r\n      }\r\n\r\n      const [rows] = await connection.query(query, values)\r\n      return rows\r\n    } catch (err) {\r\n      console.error(`[DB ERROR] Query failed:`, err)\r\n      throw err\r\n    } finally {\r\n      connection.release()\r\n    }\r\n  }\r\n} else {\r\n  throw new Error(\r\n    `Unsupported database URL format. Use postgresql:// (Neon) or mysql:// (XAMPP). Got: ${connectionString.split(\"://\")[0]}://`\r\n  )\r\n}\r\n\r\nexport { sql }\r\n\r\n// Type definitions for database operations\r\nexport interface User {\r\n  id: number\r\n  email: string\r\n  name: string\r\n  role: \"cashier\" | \"manager\" | \"inventory_officer\"\r\n  is_active: boolean\r\n  created_at: string\r\n}\r\n\r\nexport interface Product {\r\n  id: number\r\n  name: string\r\n  category: string\r\n  price: number\r\n  description: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  is_active: boolean\r\n}\r\n\r\nexport interface Order {\r\n  id: number\r\n  order_number: string\r\n  cashier_id: number\r\n  customer_name: string\r\n  total_amount: number\r\n  payment_method: string\r\n  order_status: string\r\n  created_at: string\r\n}\r\n\r\nexport interface OrderItem {\r\n  id: number\r\n  order_id: number\r\n  product_id: number\r\n  quantity: number\r\n  unit_price: number\r\n  subtotal: number\r\n}\r\n\r\nexport interface InventoryLog {\r\n  id: number\r\n  ingredient_id: number\r\n  ingredient_name?: string\r\n  user_id: number\r\n  user_name?: string\r\n  log_type: string\r\n  quantity_changed: number\r\n  reason: string\r\n  previous_quantity: number\r\n  new_quantity: number\r\n  created_at: string\r\n}\r\n\r\nexport interface Ingredient {\r\n  id: number\r\n  name: string\r\n  unit: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  cost_per_unit: number\r\n  updated_at: string\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,6DAA6D;AAC7D,MAAM,aAAa,iBAAiB,UAAU,CAAC;AAC/C,MAAM,UAAU,iBAAiB,UAAU,CAAC;AAE5C,IAAI;AAEJ,IAAI,YAAY;IACd,0BAA0B;IAC1B,MAAM,IAAA,+KAAI,EAAC;AACb,OAAO,IAAI,SAAS;IAClB,6BAA6B;IAC7B,MAAM,OAAO,6JAAK,CAAC,UAAU,CAAC;QAC5B,KAAK;QACL,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;IACd;IAEA,qDAAqD;IACrD,MAAM,OAAO,SAA+B,GAAG;QAC7C,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,IAAI;YACF,oCAAoC;YACpC,IAAI,QAAQ,OAAO,CAAC,EAAE;YACtB,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;gBACtC,SAAS,MAAM,OAAO,CAAC,IAAI,EAAE;YAC/B;YAEA,gBAAgB;YAChB,wCAA4C;gBAC1C,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,MAAM;gBAC9D,IAAI,OAAO,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,CAAC,YAAY,CAAC,EAAE;YACrD;YAEA,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,KAAK,CAAC,OAAO;YAC7C,OAAO;QACT,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,CAAC,wBAAwB,CAAC,EAAE;YAC1C,MAAM;QACR,SAAU;YACR,WAAW,OAAO;QACpB;IACF;AACF,OAAO;IACL,MAAM,IAAI,MACR,CAAC,oFAAoF,EAAE,iBAAiB,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC;AAEhI","debugId":null}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Terryl%20Jean/Downloads/sodalicious/lib/menu-data.ts"],"sourcesContent":["/**\r\n * SODALICIOUS.CO ‚Äì Complete POS Menu Data\r\n * Synced across Cashier, Manager, and Inventory panels\r\n * All prices in PHP, Stock quantities for tracking\r\n */\r\n\r\nexport interface MenuItem {\r\n  id: string\r\n  name: string\r\n  category: string\r\n  categoryCode: string\r\n  sizes: Array<{\r\n    size: string\r\n    price: number\r\n  }>\r\n  description?: string\r\n  stock: number\r\n  minThreshold: number\r\n  image?: string\r\n  bottleneck_ingredient?: string\r\n  ingredients_list?: string\r\n}\r\n\r\n// ‚òï HOT COFFEE\r\nexport const HOT_COFFEE: MenuItem[] = [\r\n  {\r\n    id: \"HC001\",\r\n    name: \"Americano\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 45 },\r\n      { size: \"M\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Classic Italian espresso with hot water\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"HC002\",\r\n    name: \"Caf√© Latte\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 55 },\r\n      { size: \"M\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Smooth espresso with steamed milk\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"HC003\",\r\n    name: \"Cappuccino\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 55 },\r\n      { size: \"M\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Espresso with equal parts milk and foam\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"HC004\",\r\n    name: \"Caramel Macchiato\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 60 },\r\n      { size: \"M\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Rich espresso with caramel and steamed milk\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"HC005\",\r\n    name: \"Mocha\",\r\n    category: \"Hot Coffee\",\r\n    categoryCode: \"HC\",\r\n    sizes: [\r\n      { size: \"S\", price: 60 },\r\n      { size: \"M\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Espresso, steamed milk, and chocolate\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n]\r\n\r\n// üßä ICED COFFEE\r\nexport const ICED_COFFEE: MenuItem[] = [\r\n  {\r\n    id: \"IC001\",\r\n    name: \"Iced Americano\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Cold espresso with ice and water\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"IC002\",\r\n    name: \"Iced Latte\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Smooth iced espresso with cold milk\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"IC003\",\r\n    name: \"Iced Caramel\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Iced espresso with caramel and milk\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"IC004\",\r\n    name: \"Iced Vanilla Brew\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 65 },\r\n      { size: \"L\", price: 75 },\r\n    ],\r\n    description: \"Cold brew with vanilla essence\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"IC005\",\r\n    name: \"Iced Mocha\",\r\n    category: \"Iced Coffee\",\r\n    categoryCode: \"IC\",\r\n    sizes: [\r\n      { size: \"R\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Iced espresso with chocolate and milk\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// ü•§ FRAPPES\r\nexport const FRAPPES: MenuItem[] = [\r\n  {\r\n    id: \"FR001\",\r\n    name: \"Chocolate Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 75 }],\r\n    description: \"Blended chocolate frappe with whipped cream\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"FR002\",\r\n    name: \"Caramel Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 75 }],\r\n    description: \"Blended caramel frappe with whipped cream\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"FR003\",\r\n    name: \"Cookies & Cream Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 80 }],\r\n    description: \"Cookies and cream blended frappe\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"FR004\",\r\n    name: \"Matcha Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 85 }],\r\n    description: \"Blended matcha frappe with whipped cream\",\r\n    stock: 40,\r\n    minThreshold: 6,\r\n  },\r\n  {\r\n    id: \"FR005\",\r\n    name: \"Coffee Jelly Frappe\",\r\n    category: \"Frappes\",\r\n    categoryCode: \"FR\",\r\n    sizes: [{ size: \"16oz\", price: 80 }],\r\n    description: \"Coffee frappe with coffee jelly bits\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n]\r\n\r\n// ü´ß SODA SERIES\r\nexport const SODA_SERIES: MenuItem[] = [\r\n  {\r\n    id: \"SS001\",\r\n    name: \"Blue Lemon Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Refreshing blue lemon carbonated drink\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SS002\",\r\n    name: \"Strawberry Fizz\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Sweet strawberry flavored soda\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SS003\",\r\n    name: \"Green Apple Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 55 },\r\n      { size: \"L\", price: 65 },\r\n    ],\r\n    description: \"Crisp green apple soda\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SS004\",\r\n    name: \"Lychee Pop Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Tropical lychee flavored soda\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n  {\r\n    id: \"SS005\",\r\n    name: \"Mango Burst Soda\",\r\n    category: \"Soda Series\",\r\n    categoryCode: \"SS\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Tropical mango soda explosion\",\r\n    stock: 40,\r\n    minThreshold: 12,\r\n  },\r\n]\r\n\r\n// üßÉ YAKULT SERIES\r\nexport const YAKULT_SERIES: MenuItem[] = [\r\n  {\r\n    id: \"YK001\",\r\n    name: \"Blue Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic blue flavored Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK002\",\r\n    name: \"Strawberry Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic strawberry Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK003\",\r\n    name: \"Green Apple Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic green apple Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK004\",\r\n    name: \"Mango Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic mango Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"YK005\",\r\n    name: \"Lychee Yakult\",\r\n    category: \"Yakult Series\",\r\n    categoryCode: \"YK\",\r\n    sizes: [\r\n      { size: \"R\", price: 60 },\r\n      { size: \"L\", price: 70 },\r\n    ],\r\n    description: \"Probiotic lychee Yakult\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// üçµ MATCHA SERIES\r\nexport const MATCHA_SERIES: MenuItem[] = [\r\n  {\r\n    id: \"MC001\",\r\n    name: \"Classic Matcha\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 70 },\r\n      { size: \"L\", price: 80 },\r\n    ],\r\n    description: \"Traditional matcha powder blend\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"MC002\",\r\n    name: \"Matcha Latte\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 75 },\r\n      { size: \"L\", price: 85 },\r\n    ],\r\n    description: \"Matcha with steamed milk\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"MC003\",\r\n    name: \"Matcha Caramel\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 80 },\r\n      { size: \"L\", price: 90 },\r\n    ],\r\n    description: \"Matcha with caramel drizzle\",\r\n    stock: 40,\r\n    minThreshold: 6,\r\n  },\r\n  {\r\n    id: \"MC004\",\r\n    name: \"Matcha Vanilla\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 75 },\r\n      { size: \"L\", price: 85 },\r\n    ],\r\n    description: \"Matcha with vanilla essence\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"MC005\",\r\n    name: \"Dirty Matcha\",\r\n    category: \"Matcha Series\",\r\n    categoryCode: \"MC\",\r\n    sizes: [\r\n      { size: \"R\", price: 85 },\r\n      { size: \"L\", price: 95 },\r\n    ],\r\n    description: \"Matcha with espresso shot\",\r\n    stock: 40,\r\n    minThreshold: 6,\r\n  },\r\n]\r\n\r\n// üç± COMBO MEALS\r\nexport const COMBO_MEALS: MenuItem[] = [\r\n  {\r\n    id: \"CM001\",\r\n    name: \"Fries + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 99 }],\r\n    description: \"Regular Fries + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"CM002\",\r\n    name: \"Siomai Rice + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 110 }],\r\n    description: \"Siomai Rice + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"CM003\",\r\n    name: \"Burger + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 120 }],\r\n    description: \"Cheeseburger + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"CM004\",\r\n    name: \"Nuggets + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 115 }],\r\n    description: \"6pcs Nuggets + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"CM005\",\r\n    name: \"Hotdog + Soda\",\r\n    category: \"Combo Meals\",\r\n    categoryCode: \"CM\",\r\n    sizes: [{ size: \"Combo\", price: 99 }],\r\n    description: \"Hotdog Sandwich + Regular Soda\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// üçü SNACKS\r\nexport const SNACKS: MenuItem[] = [\r\n  {\r\n    id: \"SN001\",\r\n    name: \"Fries\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [\r\n      { size: \"Reg\", price: 45 },\r\n      { size: \"Lrg\", price: 60 },\r\n    ],\r\n    description: \"Crispy golden fries\",\r\n    stock: 40,\r\n    minThreshold: 15,\r\n  },\r\n  {\r\n    id: \"SN002\",\r\n    name: \"Kropek\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"Solo\", price: 45 }],\r\n    description: \"Crispy prawn cracker\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"SN003\",\r\n    name: \"Nachos\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"Solo\", price: 60 }],\r\n    description: \"Cheese nachos with dip\",\r\n    stock: 40,\r\n    minThreshold: 8,\r\n  },\r\n  {\r\n    id: \"SN004\",\r\n    name: \"Cheese Sticks\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"6 pcs\", price: 50 }],\r\n    description: \"Golden fried cheese sticks\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n  {\r\n    id: \"SN005\",\r\n    name: \"Siomai Rice\",\r\n    category: \"Snacks\",\r\n    categoryCode: \"SN\",\r\n    sizes: [{ size: \"Solo\", price: 55 }],\r\n    description: \"Siomai served with rice\",\r\n    stock: 40,\r\n    minThreshold: 10,\r\n  },\r\n]\r\n\r\n// Combined complete menu\r\nexport const COMPLETE_MENU: MenuItem[] = [\r\n  ...HOT_COFFEE,\r\n  ...ICED_COFFEE,\r\n  ...FRAPPES,\r\n  ...SODA_SERIES,\r\n  ...YAKULT_SERIES,\r\n  ...MATCHA_SERIES,\r\n  ...COMBO_MEALS,\r\n  ...SNACKS,\r\n]\r\n\r\n// Menu categories for filtering\r\nexport const MENU_CATEGORIES = [\r\n  { code: \"HC\", name: \"Hot Coffee\", emoji: \"‚òï\" },\r\n  { code: \"IC\", name: \"Iced Coffee\", emoji: \"üßä\" },\r\n  { code: \"FR\", name: \"Frappes\", emoji: \"ü•§\" },\r\n  { code: \"SS\", name: \"Soda Series\", emoji: \"ü´ß\" },\r\n  { code: \"YK\", name: \"Yakult Series\", emoji: \"üßÉ\" },\r\n  { code: \"MC\", name: \"Matcha Series\", emoji: \"üçµ\" },\r\n  { code: \"CM\", name: \"Combo Meals\", emoji: \"üç±\" },\r\n  { code: \"SN\", name: \"Snacks\", emoji: \"üçü\" },\r\n]\r\n\r\n// Helper function to get menu items by category\r\nexport function getMenuByCategory(categoryCode: string): MenuItem[] {\r\n  return COMPLETE_MENU.filter((item) => item.categoryCode === categoryCode)\r\n}\r\n\r\n// Helper function to get all categories\r\nexport function getAllCategories(): string[] {\r\n  return MENU_CATEGORIES.map((cat) => cat.name)\r\n}\r\n\r\n// Helper function to convert MenuItem to Product format for store compatibility\r\nexport function menuItemToProduct(item: MenuItem, sizeIndex: number = 0) {\r\n  const size = item.sizes[sizeIndex]\r\n  return {\r\n    id: item.id,\r\n    name: `${item.name} (${size.size})`,\r\n    price: size.price,\r\n    category: item.category,\r\n    stock: item.stock,\r\n    minThreshold: item.minThreshold,\r\n    description: item.description,\r\n    image: item.image,\r\n  }\r\n}\r\n\r\n// Get all products flattened with sizes as separate entries\r\nexport function getAllProductVariants() {\r\n  return COMPLETE_MENU.flatMap((item) =>\r\n    item.sizes.map((size, index) => ({\r\n      id: `${item.id}-${size.size}`,\r\n      baseId: item.id,\r\n      name: item.name,\r\n      size: size.size,\r\n      price: size.price,\r\n      category: item.category,\r\n      categoryCode: item.categoryCode,\r\n      stock: item.stock,\r\n      minThreshold: item.minThreshold,\r\n      description: item.description,\r\n      image: item.image,\r\n    })),\r\n  )\r\n}\r\n\r\n// Get base menu items (one per drink, no size duplication) - for cashier modal selection\r\nexport function getBaseMenuItems() {\r\n  return COMPLETE_MENU.map((item) => ({\r\n    id: item.id,\r\n    name: item.name,\r\n    category: item.category,\r\n    categoryCode: item.categoryCode,\r\n    sizes: item.sizes,\r\n    description: item.description,\r\n    stock: item.stock,\r\n    minThreshold: item.minThreshold,\r\n    image: item.image,\r\n    bottleneck_ingredient: item.bottleneck_ingredient,\r\n    ingredients_list: item.ingredients_list,\r\n  }))\r\n}\r\n\r\n// Stock management functions\r\nexport function deductStock(productId: string, quantity: number): boolean {\r\n  const item = COMPLETE_MENU.find((i) => i.id === productId)\r\n  if (!item) return false\r\n  if (item.stock < quantity) return false\r\n\r\n  item.stock -= quantity\r\n  return true\r\n}\r\n\r\nexport function getProductById(productId: string): MenuItem | undefined {\r\n  return COMPLETE_MENU.find((i) => i.id === productId)\r\n}\r\n\r\nexport function updateProductStock(productId: string, newStock: number): boolean {\r\n  const item = COMPLETE_MENU.find((i) => i.id === productId)\r\n  if (!item) return false\r\n\r\n  item.stock = Math.max(0, newStock)\r\n  return true\r\n}\r\n\r\n// Find a menu item by base name (e.g. \"Americano\")\r\nexport function findMenuItemByName(baseName: string) {\r\n  return COMPLETE_MENU.find((i) => i.name === baseName)\r\n}\r\n\r\n// Adjust stock by a delta using the base product name. Positive delta = restock.\r\nexport function changeStockByName(baseName: string, delta: number): boolean {\r\n  const item = findMenuItemByName(baseName)\r\n  if (!item) return false\r\n  item.stock = Math.max(0, item.stock + delta)\r\n  return true\r\n}\r\n\r\n// Set absolute stock by base product name.\r\nexport function setStockByName(baseName: string, newStock: number): boolean {\r\n  const item = findMenuItemByName(baseName)\r\n  if (!item) return false\r\n  item.stock = Math.max(0, newStock)\r\n  return true\r\n}\r\n\r\nexport function getStockLevel(productId: string): number {\r\n  const item = COMPLETE_MENU.find((i) => i.id === productId)\r\n  return item?.stock || 0\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Terryl%20Jean/Downloads/sodalicious/app/api/orders/route.ts"],"sourcesContent":["import { sql } from \"@/lib/db\"\r\nimport { deductStock, getProductById } from \"@/lib/menu-data\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams\r\n    const limit = searchParams.get(\"limit\") || \"50\"\r\n\r\n    const orders = await sql`\r\n      SELECT o.*, u.name as cashier_name FROM orders o \r\n      LEFT JOIN users u ON o.cashier_id = u.id \r\n      ORDER BY o.created_at DESC LIMIT ${Number.parseInt(limit)}\r\n    `\r\n    return NextResponse.json(orders)\r\n  } catch (error) {\r\n    console.error(\"[API] Orders GET error:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch orders\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  console.log(\"[Order API] Incoming POST request\")\r\n  try {\r\n    const body = await request.json()\r\n    const { cashier_id, customer_name, total_amount, payment_method, items } = body\r\n    console.log(`[Order API] Processing order with ${items?.length} items`)\r\n\r\n    if (!items || items.length === 0) {\r\n      return NextResponse.json({ error: \"Order must have at least one item\" }, { status: 400 })\r\n    }\r\n\r\n    const orderNumber = `ORD-${Date.now()}`\r\n\r\n    // 1. Deduct Stock in memory (Immediate UI feedback)\r\n    for (const item of items) {\r\n      const pId = item.productId || item.product_id\r\n      if (pId) {\r\n        deductStock(pId.toString(), item.quantity)\r\n        console.log(`[Order API] In-memory deduction for ${item.name} (${pId})`)\r\n      }\r\n    }\r\n\r\n    // 2. Database Sync (Persistent deduction)\r\n    try {\r\n      // Ensure numeric cashierId\r\n      let validCashierId = 1\r\n      if (cashier_id && !isNaN(Number(cashier_id))) {\r\n        validCashierId = Number(cashier_id)\r\n      } else {\r\n        const fallback = await sql`SELECT id FROM users WHERE role = 'cashier' LIMIT 1`\r\n        if (fallback.length > 0) validCashierId = fallback[0].id\r\n      }\r\n\r\n      console.log(`[Order API] Using Cashier ID: ${validCashierId}`)\r\n\r\n      // Create Order\r\n      const orderResult = await sql`\r\n        INSERT INTO orders (order_number, cashier_id, customer_name, total_amount, payment_method, order_status) \r\n        VALUES (${orderNumber}, ${validCashierId}, ${customer_name}, ${total_amount}, ${payment_method}, 'completed')\r\n      `\r\n\r\n      const inserted = await sql`SELECT id FROM orders WHERE order_number = ${orderNumber} LIMIT 1`\r\n      const orderId = inserted[0]?.id || (orderResult as any).insertId\r\n      console.log(`[Order API] Created DB Order ID: ${orderId}`)\r\n\r\n      for (const item of items) {\r\n        const fullName = String(item.name)\r\n        const baseName = fullName.split(\" (\")[0]\r\n        console.log(`[Order API] Mapping item: \"${fullName}\" (Base: \"${baseName}\")`)\r\n\r\n        let products = await sql`SELECT id FROM products WHERE name = ${fullName} LIMIT 1`\r\n        if (!products || products.length === 0) {\r\n          products = await sql`SELECT id FROM products WHERE name = ${baseName} LIMIT 1`\r\n        }\r\n\r\n        if (products && products.length > 0) {\r\n          const dbProductId = products[0].id\r\n          console.log(`[Order API] Found DB Product: ${fullName} (ID: ${dbProductId})`)\r\n\r\n          await sql`\r\n            INSERT INTO order_items (order_id, product_id, quantity, unit_price, subtotal) \r\n            VALUES (${orderId}, ${dbProductId}, ${item.quantity}, ${item.price}, ${item.subtotal})\r\n          `\r\n\r\n          // Ingredient Deduction Logic\r\n          const recipes = await sql`\r\n            SELECT pi.ingredient_id, pi.amount, i.stock_quantity, i.name as ing_name\r\n            FROM product_ingredients pi\r\n            JOIN ingredients i ON pi.ingredient_id = i.id\r\n            WHERE pi.product_id = ${dbProductId}\r\n          `\r\n\r\n          console.log(`[Order API] Found ${recipes.length} ingredients for ${baseName}`)\r\n\r\n          for (const recipe of recipes) {\r\n            const deduction = Number(recipe.amount) * Number(item.quantity)\r\n            const prevStock = Number(recipe.stock_quantity)\r\n            const newStock = prevStock - deduction\r\n\r\n            console.log(`[Order API] Deducting ${deduction} from ${recipe.ing_name}. Prev: ${prevStock}, New: ${newStock}`)\r\n\r\n            await sql`UPDATE ingredients SET stock_quantity = ${newStock} WHERE id = ${recipe.ingredient_id}`\r\n\r\n            await sql`\r\n              INSERT INTO inventory_logs (ingredient_id, user_id, log_type, quantity_changed, reason, previous_quantity, new_quantity)\r\n              VALUES (${recipe.ingredient_id}, ${validCashierId}, 'sale', ${-deduction}, ${`Order ${orderNumber}`}, ${prevStock}, ${newStock})\r\n            `\r\n          }\r\n        } else {\r\n          console.warn(`[Order API] ‚ö†Ô∏è Could not find product in DB: ${baseName}`)\r\n        }\r\n      }\r\n\r\n      console.log(`[Order API] ‚úì Order ${orderNumber} fully processed and synced.`)\r\n\r\n      return NextResponse.json({\r\n        id: orderId,\r\n        order_number: orderNumber,\r\n        customer_name,\r\n        total_amount,\r\n        payment_method,\r\n        order_status: \"completed\",\r\n        created_at: new Date().toISOString()\r\n      }, { status: 201 })\r\n\r\n    } catch (dbError) {\r\n      console.error(\"[Order API] ‚ùå Database synchronization failed:\", dbError)\r\n      return NextResponse.json({\r\n        order_number: orderNumber,\r\n        order_status: \"partial\",\r\n        warning: \"Database sync failed, but stock was updated in-memory.\",\r\n        created_at: new Date().toISOString()\r\n      }, { status: 201 })\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[Order API] ‚ùå Critical Error:\", error)\r\n    return NextResponse.json({ error: \"Failed to process order\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}