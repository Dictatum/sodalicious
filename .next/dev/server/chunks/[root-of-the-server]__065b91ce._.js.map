{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\r\nimport mysql from \"mysql2/promise\"\r\n\r\nconst connectionString = process.env.DATABASE_URL\r\n\r\nif (!connectionString) {\r\n  throw new Error(\"DATABASE_URL environment variable is not set\")\r\n}\r\n\r\n// Detect connection type: PostgreSQL (Neon) or MySQL (XAMPP)\r\nconst isPostgres = connectionString.startsWith(\"postgresql://\")\r\nconst isMysql = connectionString.startsWith(\"mysql://\")\r\n\r\nlet sql: any\r\n\r\nif (isPostgres) {\r\n  // Use Neon for PostgreSQL\r\n  sql = neon(connectionString)\r\n} else if (isMysql) {\r\n  // Use mysql2 for MySQL/XAMPP\r\n  const pool = mysql.createPool({\r\n    uri: connectionString,\r\n    waitForConnections: true,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  })\r\n\r\n  // Create a wrapper for mysql2 that mimics neon's API\r\n  sql = async (strings: TemplateStringsArray, ...values: any[]) => {\r\n    const connection = await pool.getConnection()\r\n    try {\r\n      // Build query from template strings\r\n      let query = strings[0]\r\n      for (let i = 0; i < values.length; i++) {\r\n        query += \"?\" + strings[i + 1]\r\n      }\r\n\r\n      // DEBUG LOGGING\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.log(`[DB] Query: ${query.trim().replace(/\\s+/g, ' ')}`)\r\n        if (values.length > 0) console.log(`[DB] Values:`, values)\r\n      }\r\n\r\n      const [rows] = await connection.query(query, values)\r\n      return rows\r\n    } catch (err) {\r\n      console.error(`[DB ERROR] Query failed:`, err)\r\n      throw err\r\n    } finally {\r\n      connection.release()\r\n    }\r\n  }\r\n} else {\r\n  throw new Error(\r\n    `Unsupported database URL format. Use postgresql:// (Neon) or mysql:// (XAMPP). Got: ${connectionString.split(\"://\")[0]}://`\r\n  )\r\n}\r\n\r\nexport { sql }\r\n\r\n// Type definitions for database operations\r\nexport interface User {\r\n  id: number\r\n  email: string\r\n  name: string\r\n  role: \"cashier\" | \"manager\" | \"inventory_officer\"\r\n  is_active: boolean\r\n  created_at: string\r\n}\r\n\r\nexport interface Product {\r\n  id: number\r\n  name: string\r\n  category: string\r\n  price: number\r\n  description: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  is_active: boolean\r\n}\r\n\r\nexport interface Order {\r\n  id: number\r\n  order_number: string\r\n  cashier_id: number\r\n  customer_name: string\r\n  total_amount: number\r\n  payment_method: string\r\n  order_status: string\r\n  created_at: string\r\n  items?: any[]\r\n}\r\n\r\nexport interface OrderItem {\r\n  id: number\r\n  order_id: number\r\n  product_id: number\r\n  quantity: number\r\n  unit_price: number\r\n  subtotal: number\r\n}\r\n\r\nexport interface InventoryLog {\r\n  id: number\r\n  ingredient_id: number\r\n  ingredient_name?: string\r\n  user_id: number\r\n  user_name?: string\r\n  log_type: string\r\n  quantity_changed: number\r\n  reason: string\r\n  previous_quantity: number\r\n  new_quantity: number\r\n  created_at: string\r\n}\r\n\r\nexport interface Ingredient {\r\n  id: number\r\n  name: string\r\n  unit: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  cost_per_unit: number\r\n  updated_at: string\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,6DAA6D;AAC7D,MAAM,aAAa,iBAAiB,UAAU,CAAC;AAC/C,MAAM,UAAU,iBAAiB,UAAU,CAAC;AAE5C,IAAI;AAEJ,IAAI,YAAY;IACd,0BAA0B;IAC1B,MAAM,IAAA,gKAAI,EAAC;AACb,OAAO,IAAI,SAAS;IAClB,6BAA6B;IAC7B,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;QAC5B,KAAK;QACL,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;IACd;IAEA,qDAAqD;IACrD,MAAM,OAAO,SAA+B,GAAG;QAC7C,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,IAAI;YACF,oCAAoC;YACpC,IAAI,QAAQ,OAAO,CAAC,EAAE;YACtB,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;gBACtC,SAAS,MAAM,OAAO,CAAC,IAAI,EAAE;YAC/B;YAEA,gBAAgB;YAChB,wCAA4C;gBAC1C,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,MAAM;gBAC9D,IAAI,OAAO,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,CAAC,YAAY,CAAC,EAAE;YACrD;YAEA,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,KAAK,CAAC,OAAO;YAC7C,OAAO;QACT,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,CAAC,wBAAwB,CAAC,EAAE;YAC1C,MAAM;QACR,SAAU;YACR,WAAW,OAAO;QACpB;IACF;AACF,OAAO;IACL,MAAM,IAAI,MACR,CAAC,oFAAoF,EAAE,iBAAiB,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC;AAEhI","debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/app/api/admin/fix-recipes/route.ts"],"sourcesContent":["import { sql } from \"@/lib/db\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function GET() {\r\n  try {\r\n    console.log(\"Starting COMPREHENSIVE recipe fix...\");\r\n\r\n    // 1. Ensure ingredients exist\r\n    const ings = [\r\n      ['Espresso Beans', 'g'], ['Milk', 'ml'], ['Caramel Syrup', 'ml'], ['Chocolate Syrup', 'ml'],\r\n      ['Vanilla Syrup', 'ml'], ['Soda Water', 'ml'], ['Cola Syrup', 'ml'], ['Lemon Syrup', 'ml'],\r\n      ['Strawberry Syrup', 'ml'], ['Mango Puree', 'ml'], ['Berry Mix', 'ml'], ['Matcha Powder', 'g'],\r\n      ['Taro Powder', 'g'], ['Tapioca Pearls', 'g'], ['Tea Leaves', 'g'], ['Pistachio Paste', 'g'],\r\n      ['Waffle Batter', 'ml'], ['Ice Cream', 'scoop'], ['Coffee Jelly', 'g'], ['Whipped Cream', 'ml'],\r\n      ['Cookie Crumbs', 'g'], ['Green Apple Syrup', 'ml'], ['Lychee Syrup', 'ml'], ['Yakult', 'ml'],\r\n      ['Orange Juice', 'ml'], ['Pineapple Juice', 'ml'], ['Watermelon Juice', 'ml'],\r\n      ['Croissant', 'pcs'], ['Chocolate Cake', 'pcs'], ['Blueberry Muffin', 'pcs'], ['Cheese Danish', 'pcs'], ['Almond Cookie', 'pcs']\r\n    ];\r\n\r\n    for (const [name, unit] of ings) {\r\n      await sql`INSERT IGNORE INTO ingredients (name, unit, stock_quantity, reorder_level) VALUES (${name}, ${unit}, 5000, 100)`;\r\n    }\r\n\r\n    // 2. Clear existing recipes\r\n    await sql`DELETE FROM product_ingredients`;\r\n    console.log(\"Cleared existing recipes.\");\r\n\r\n    // 3. Recipes Logic\r\n\r\n    // Coffee Base\r\n    await sql`INSERT INTO product_ingredients (product_id, ingredient_id, amount)\r\n      SELECT id, (SELECT id FROM ingredients WHERE name='Espresso Beans'), 18\r\n      FROM products WHERE category IN ('Hot Coffee', 'Iced Coffee', 'Specialty') AND name NOT LIKE '%Tea%' AND name NOT LIKE '%Soda%'`;\r\n\r\n    // Milk Base\r\n    await sql`INSERT INTO product_ingredients (product_id, ingredient_id, amount)\r\n      SELECT id, (SELECT id FROM ingredients WHERE name='Milk'), 200\r\n      FROM products WHERE (category IN ('Hot Coffee', 'Iced Coffee', 'Specialty') OR name LIKE '%Latte%' OR name LIKE '%Matcha%')\r\n      AND name NOT LIKE '%Americano%' AND name NOT LIKE '%Espresso%' AND name NOT LIKE '%Long Black%' AND name NOT LIKE '%Soda%'`;\r\n\r\n    // Soda Base\r\n    await sql`INSERT INTO product_ingredients (product_id, ingredient_id, amount)\r\n      SELECT id, (SELECT id FROM ingredients WHERE name='Soda Water'), 250\r\n      FROM products WHERE category LIKE '%Soda%' OR name LIKE '%Fizz%' OR name LIKE '%Splash%'`;\r\n\r\n    // Yakult Base\r\n    await sql`INSERT INTO product_ingredients (product_id, ingredient_id, amount)\r\n      SELECT id, (SELECT id FROM ingredients WHERE name='Yakult'), 100\r\n      FROM products WHERE category LIKE '%Yakult%' OR name LIKE '%Yakult%'`;\r\n\r\n    // Tea Base\r\n    await sql`INSERT INTO product_ingredients (product_id, ingredient_id, amount)\r\n      SELECT id, (SELECT id FROM ingredients WHERE name='Tea Leaves'), 10\r\n      FROM products WHERE name LIKE '%Tea%' OR category = 'Tea';`;\r\n\r\n    // SYRUPS / FLAVORS (Pattern Matching)\r\n    const flavors = [\r\n      { key: '%Caramel%', ing: 'Caramel Syrup', amt: 20 },\r\n      { key: '%Mocha%', ing: 'Chocolate Syrup', amt: 20 },\r\n      { key: '%Choco%', ing: 'Chocolate Syrup', amt: 20 },\r\n      { key: '%Vanilla%', ing: 'Vanilla Syrup', amt: 20 },\r\n      { key: '%Strawberry%', ing: 'Strawberry Syrup', amt: 40 },\r\n      { key: '%Mango%', ing: 'Mango Puree', amt: 40 },\r\n      { key: '%Berry%', ing: 'Berry Mix', amt: 40 },\r\n      { key: '%Cola%', ing: 'Cola Syrup', amt: 50 },\r\n      { key: '%Matcha%', ing: 'Matcha Powder', amt: 15 },\r\n      { key: '%Taro%', ing: 'Taro Powder', amt: 20 },\r\n      { key: '%Apple%', ing: 'Green Apple Syrup', amt: 40 },\r\n      { key: '%Lychee%', ing: 'Lychee Syrup', amt: 40 },\r\n      { key: '%Orange%', ing: 'Orange Juice', amt: 300 },\r\n      { key: '%Pineapple%', ing: 'Pineapple Juice', amt: 300 },\r\n      { key: '%Watermelon%', ing: 'Watermelon Juice', amt: 300 }\r\n    ];\r\n\r\n    for (const flavor of flavors) {\r\n      await sql`\r\n        INSERT IGNORE INTO product_ingredients (product_id, ingredient_id, amount)\r\n        SELECT p.id, i.id, ${flavor.amt}\r\n        FROM products p, ingredients i\r\n        WHERE p.name LIKE ${flavor.key} AND i.name = ${flavor.ing}\r\n      `;\r\n    }\r\n\r\n    // Food (1-to-1)\r\n    await sql`\r\n      INSERT IGNORE INTO product_ingredients (product_id, ingredient_id, amount)\r\n      SELECT p.id, i.id, 1\r\n      FROM products p\r\n      JOIN ingredients i ON p.name = i.name\r\n      WHERE p.category = 'Food'\r\n    `;\r\n\r\n    // Count results\r\n    const [countResult] = await sql`SELECT COUNT(*) as total FROM product_ingredients`;\r\n    const total = (countResult as any).total || 0;\r\n\r\n    console.log(`Recipe fix complete. Total links: ${total}`);\r\n    return NextResponse.json({ success: true, count: total });\r\n  } catch (error) {\r\n    console.error(\"Recipe fix error:\", error);\r\n    return NextResponse.json({ success: false, error: String(error) }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}