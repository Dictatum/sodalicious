{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/lib/db.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\r\nimport mysql from \"mysql2/promise\"\r\n\r\nconst connectionString = process.env.DATABASE_URL\r\n\r\nif (!connectionString) {\r\n  throw new Error(\"DATABASE_URL environment variable is not set\")\r\n}\r\n\r\n// Detect connection type: PostgreSQL (Neon) or MySQL (XAMPP)\r\nconst isPostgres = connectionString.startsWith(\"postgresql://\")\r\nconst isMysql = connectionString.startsWith(\"mysql://\")\r\n\r\nlet sql: any\r\n\r\nif (isPostgres) {\r\n  // Use Neon for PostgreSQL\r\n  sql = neon(connectionString)\r\n} else if (isMysql) {\r\n  // Use mysql2 for MySQL/XAMPP\r\n  const pool = mysql.createPool({\r\n    uri: connectionString,\r\n    waitForConnections: true,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  })\r\n\r\n  // Create a wrapper for mysql2 that mimics neon's API\r\n  sql = async (strings: TemplateStringsArray, ...values: any[]) => {\r\n    const connection = await pool.getConnection()\r\n    try {\r\n      // Build query from template strings\r\n      let query = strings[0]\r\n      for (let i = 0; i < values.length; i++) {\r\n        query += \"?\" + strings[i + 1]\r\n      }\r\n\r\n      // DEBUG LOGGING\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.log(`[DB] Query: ${query.trim().replace(/\\s+/g, ' ')}`)\r\n        if (values.length > 0) console.log(`[DB] Values:`, values)\r\n      }\r\n\r\n      const [rows] = await connection.query(query, values)\r\n      return rows\r\n    } catch (err) {\r\n      console.error(`[DB ERROR] Query failed:`, err)\r\n      throw err\r\n    } finally {\r\n      connection.release()\r\n    }\r\n  }\r\n} else {\r\n  throw new Error(\r\n    `Unsupported database URL format. Use postgresql:// (Neon) or mysql:// (XAMPP). Got: ${connectionString.split(\"://\")[0]}://`\r\n  )\r\n}\r\n\r\nexport { sql }\r\n\r\n// Type definitions for database operations\r\nexport interface User {\r\n  id: number\r\n  email: string\r\n  name: string\r\n  role: \"cashier\" | \"manager\" | \"inventory_officer\"\r\n  is_active: boolean\r\n  created_at: string\r\n}\r\n\r\nexport interface Product {\r\n  id: number\r\n  name: string\r\n  category: string\r\n  price: number\r\n  description: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  is_active: boolean\r\n}\r\n\r\nexport interface Order {\r\n  id: number\r\n  order_number: string\r\n  cashier_id: number\r\n  customer_name: string\r\n  total_amount: number\r\n  payment_method: string\r\n  order_status: string\r\n  created_at: string\r\n  items?: any[]\r\n}\r\n\r\nexport interface OrderItem {\r\n  id: number\r\n  order_id: number\r\n  product_id: number\r\n  quantity: number\r\n  unit_price: number\r\n  subtotal: number\r\n}\r\n\r\nexport interface InventoryLog {\r\n  id: number\r\n  ingredient_id: number\r\n  ingredient_name?: string\r\n  user_id: number\r\n  user_name?: string\r\n  log_type: string\r\n  quantity_changed: number\r\n  reason: string\r\n  previous_quantity: number\r\n  new_quantity: number\r\n  created_at: string\r\n}\r\n\r\nexport interface Ingredient {\r\n  id: number\r\n  name: string\r\n  unit: string\r\n  stock_quantity: number\r\n  reorder_level: number\r\n  cost_per_unit: number\r\n  updated_at: string\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,6DAA6D;AAC7D,MAAM,aAAa,iBAAiB,UAAU,CAAC;AAC/C,MAAM,UAAU,iBAAiB,UAAU,CAAC;AAE5C,IAAI;AAEJ,IAAI,YAAY;IACd,0BAA0B;IAC1B,MAAM,IAAA,gKAAI,EAAC;AACb,OAAO,IAAI,SAAS;IAClB,6BAA6B;IAC7B,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;QAC5B,KAAK;QACL,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;IACd;IAEA,qDAAqD;IACrD,MAAM,OAAO,SAA+B,GAAG;QAC7C,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,IAAI;YACF,oCAAoC;YACpC,IAAI,QAAQ,OAAO,CAAC,EAAE;YACtB,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;gBACtC,SAAS,MAAM,OAAO,CAAC,IAAI,EAAE;YAC/B;YAEA,gBAAgB;YAChB,wCAA4C;gBAC1C,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,MAAM;gBAC9D,IAAI,OAAO,MAAM,GAAG,GAAG,QAAQ,GAAG,CAAC,CAAC,YAAY,CAAC,EAAE;YACrD;YAEA,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,KAAK,CAAC,OAAO;YAC7C,OAAO;QACT,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,CAAC,wBAAwB,CAAC,EAAE;YAC1C,MAAM;QACR,SAAU;YACR,WAAW,OAAO;QACpB;IACF;AACF,OAAO;IACL,MAAM,IAAI,MACR,CAAC,oFAAoF,EAAE,iBAAiB,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC;AAEhI","debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/sodalicious/app/api/products/%5Bid%5D/route.ts"],"sourcesContent":["import { sql } from \"@/lib/db\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n\r\n    // 1. Fetch Product\r\n    const productResult = await sql`SELECT * FROM products WHERE id = ${id}`\r\n    if (productResult.length === 0) {\r\n      return NextResponse.json({ error: \"Product not found\" }, { status: 404 })\r\n    }\r\n    const product = productResult[0]\r\n\r\n    // 2. Fetch Ingredients (Recipe)\r\n    const ingredients = await sql`\r\n      SELECT \r\n        pi.ingredient_id, \r\n        i.name, \r\n        i.unit, \r\n        pi.amount \r\n      FROM product_ingredients pi\r\n      JOIN ingredients i ON pi.ingredient_id = i.id\r\n      WHERE pi.product_id = ${id}\r\n    `\r\n\r\n    return NextResponse.json({ ...product, ingredients })\r\n  } catch (error) {\r\n    console.error(\"[Product API] GET error:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch product\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PUT(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    const body = await request.json()\r\n    const { name, category, price, description, stock_quantity, min_threshold, ingredients } = body\r\n\r\n    // 1. Update Product\r\n    await sql`\r\n      UPDATE products \r\n      SET \r\n        name = ${name}, \r\n        category = ${category}, \r\n        price = ${price}, \r\n        description = ${description},\r\n        stock_quantity = ${stock_quantity}, \r\n        min_threshold = ${min_threshold}\r\n      WHERE id = ${id}\r\n    `\r\n\r\n    // 2. Update Ingredients (Recipe)\r\n    // First, delete existing\r\n    await sql`DELETE FROM product_ingredients WHERE product_id = ${id}`\r\n\r\n    // Then insert new if any\r\n    if (ingredients && Array.isArray(ingredients) && ingredients.length > 0) {\r\n      for (const ing of ingredients) {\r\n        if (ing.ingredient_id && ing.amount > 0) {\r\n          await sql`\r\n            INSERT INTO product_ingredients (product_id, ingredient_id, amount)\r\n            VALUES (${id}, ${ing.ingredient_id}, ${ing.amount})\r\n          `\r\n        }\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({ success: true })\r\n  } catch (error) {\r\n    console.error(\"[Product API] PUT error:\", error)\r\n    return NextResponse.json({ error: \"Failed to update product\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params\r\n\r\n    // Cascade delete should handle ingredients, but we can be explicit if needed.\r\n    // Schema says ON DELETE CASCADE, so deleting product is enough.\r\n    await sql`DELETE FROM products WHERE id = ${id}`\r\n\r\n    return NextResponse.json({ success: true })\r\n  } catch (error) {\r\n    console.error(\"[Product API] DELETE error:\", error)\r\n    return NextResponse.json({ error: \"Failed to delete product\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,mBAAmB;QACnB,MAAM,gBAAgB,MAAM,kHAAG,CAAC,kCAAkC,EAAE,GAAG,CAAC;QACxE,IAAI,cAAc,MAAM,KAAK,GAAG;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QACA,MAAM,UAAU,aAAa,CAAC,EAAE;QAEhC,gCAAgC;QAChC,MAAM,cAAc,MAAM,kHAAG,CAAC;;;;;;;;4BAQN,EAAE,GAAG;IAC7B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,GAAG,OAAO;YAAE;QAAY;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,WAAW,EAAE,cAAc,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG;QAE3F,oBAAoB;QACpB,MAAM,kHAAG,CAAC;;;eAGC,EAAE,KAAK;mBACH,EAAE,SAAS;gBACd,EAAE,MAAM;sBACF,EAAE,YAAY;yBACX,EAAE,eAAe;wBAClB,EAAE,cAAc;iBACvB,EAAE,GAAG;IAClB,CAAC;QAED,iCAAiC;QACjC,yBAAyB;QACzB,MAAM,kHAAG,CAAC,mDAAmD,EAAE,GAAG,CAAC;QAEnE,yBAAyB;QACzB,IAAI,eAAe,MAAM,OAAO,CAAC,gBAAgB,YAAY,MAAM,GAAG,GAAG;YACvE,KAAK,MAAM,OAAO,YAAa;gBAC7B,IAAI,IAAI,aAAa,IAAI,IAAI,MAAM,GAAG,GAAG;oBACvC,MAAM,kHAAG,CAAC;;oBAEA,EAAE,GAAG,EAAE,EAAE,IAAI,aAAa,CAAC,EAAE,EAAE,IAAI,MAAM,CAAC;UACpD,CAAC;gBACH;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF;AAEO,eAAe,OACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,8EAA8E;QAC9E,gEAAgE;QAChE,MAAM,kHAAG,CAAC,gCAAgC,EAAE,GAAG,CAAC;QAEhD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF","debugId":null}}]
}